{
  "name": "question-decomposition",
  "description": "Decompose a complex question into sub-queries, search each in parallel, merge results, and synthesize a comprehensive answer.",
  "version": "1.0.0",
  "inputs": {
    "query": {
      "type": "string",
      "required": true
    },
    "collection": {
      "type": "string",
      "required": true
    },
    "limit": {
      "type": "number",
      "default": 10
    }
  },
  "defaults": {},
  "steps": [
    {
      "id": "decompose",
      "tool": "generate",
      "name": "Decompose question into sub-queries",
      "inputs": {
        "prompt": "Break the following complex question into exactly 3 focused sub-questions. Return ONLY a JSON array of strings, nothing else.\n\nQuestion: {{ inputs.query }}",
        "format": "json"
      }
    },
    {
      "id": "search_sub1",
      "tool": "query",
      "name": "Search for sub-question 1",
      "inputs": {
        "query": "{{ decompose.output.response[0] }}",
        "collection": "{{ inputs.collection }}",
        "limit": 10
      }
    },
    {
      "id": "search_sub2",
      "tool": "query",
      "name": "Search for sub-question 2",
      "inputs": {
        "query": "{{ decompose.output.response[1] }}",
        "collection": "{{ inputs.collection }}",
        "limit": 10
      }
    },
    {
      "id": "search_sub3",
      "tool": "query",
      "name": "Search for sub-question 3",
      "inputs": {
        "query": "{{ decompose.output.response[2] }}",
        "collection": "{{ inputs.collection }}",
        "limit": 10
      }
    },
    {
      "id": "merged",
      "tool": "merge",
      "name": "Merge all sub-query results",
      "inputs": {
        "arrays": [
          "{{ search_sub1.output.results }}",
          "{{ search_sub2.output.results }}",
          "{{ search_sub3.output.results }}"
        ],
        "dedup": true
      }
    },
    {
      "id": "final_rerank",
      "tool": "rerank",
      "name": "Rerank against original question",
      "inputs": {
        "query": "{{ inputs.query }}",
        "documents": "{{ merged.output.results }}",
        "model": "rerank-2.5",
        "limit": "{{ inputs.limit }}"
      }
    },
    {
      "id": "synthesize",
      "tool": "generate",
      "name": "Synthesize comprehensive answer",
      "inputs": {
        "prompt": "Using the following retrieved documents, provide a comprehensive answer to the question. Cite specific documents where relevant.\n\nQuestion: {{ inputs.query }}\n\nSub-questions explored:\n1. {{ decompose.output.response[0] }}\n2. {{ decompose.output.response[1] }}\n3. {{ decompose.output.response[2] }}",
        "context": "{{ final_rerank.output.results }}"
      }
    }
  ],
  "output": {
    "answer": "{{ synthesize.output.response }}",
    "sub_questions": "{{ decompose.output.response }}",
    "sources": "{{ final_rerank.output.results }}"
  }
}
