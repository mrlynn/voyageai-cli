{
  "name": "hybrid-precision-search",
  "description": "Run three retrieval strategies in parallel (broad, precise, filtered), merge results, and rerank for optimal relevance.",
  "version": "1.0.0",
  "inputs": {
    "query": {
      "type": "string",
      "required": true
    },
    "collection": {
      "type": "string",
      "required": true
    },
    "filter": {
      "type": "object",
      "default": {}
    },
    "limit": {
      "type": "number",
      "default": 10
    }
  },
  "defaults": {},
  "steps": [
    {
      "id": "broad_search",
      "tool": "search",
      "name": "Broad retrieval with voyage-4-lite",
      "inputs": {
        "query": "{{ inputs.query }}",
        "collection": "{{ inputs.collection }}",
        "model": "voyage-4-lite",
        "limit": 20
      }
    },
    {
      "id": "precise_search",
      "tool": "query",
      "name": "Precise retrieval with voyage-4-large + rerank",
      "inputs": {
        "query": "{{ inputs.query }}",
        "collection": "{{ inputs.collection }}",
        "model": "voyage-4-large",
        "limit": 20
      }
    },
    {
      "id": "filtered_search",
      "tool": "search",
      "name": "Filtered retrieval with metadata constraints",
      "inputs": {
        "query": "{{ inputs.query }}",
        "collection": "{{ inputs.collection }}",
        "model": "voyage-4",
        "filter": "{{ inputs.filter }}",
        "limit": 20
      }
    },
    {
      "id": "merged",
      "tool": "merge",
      "name": "Merge and deduplicate all results",
      "inputs": {
        "arrays": [
          "{{ broad_search.output.results }}",
          "{{ precise_search.output.results }}",
          "{{ filtered_search.output.results }}"
        ],
        "dedup": true
      }
    },
    {
      "id": "final_rerank",
      "tool": "rerank",
      "name": "Rerank merged results for final ordering",
      "inputs": {
        "query": "{{ inputs.query }}",
        "documents": "{{ merged.output.results }}",
        "model": "rerank-2.5",
        "limit": "{{ inputs.limit }}"
      }
    }
  ],
  "output": "{{ final_rerank.output.results }}"
}
