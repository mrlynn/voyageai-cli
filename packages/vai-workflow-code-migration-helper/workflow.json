{
  "name": "code-migration-helper",
  "description": "Find similar code patterns across repositories and generate migration suggestions using code-domain embeddings.",
  "version": "1.0.0",
  "inputs": {
    "code_snippet": {
      "type": "string",
      "required": true
    },
    "target_framework": {
      "type": "string",
      "required": true
    },
    "collection": {
      "type": "string",
      "required": true
    },
    "limit": {
      "type": "number",
      "default": 5
    }
  },
  "defaults": {},
  "steps": [
    {
      "id": "find_patterns",
      "tool": "query",
      "name": "Search for similar code patterns",
      "inputs": {
        "query": "{{ inputs.code_snippet }}",
        "collection": "{{ inputs.collection }}",
        "model": "voyage-code-3",
        "limit": 15
      }
    },
    {
      "id": "rerank_code",
      "tool": "rerank",
      "name": "Rerank by code pattern relevance",
      "inputs": {
        "query": "{{ inputs.code_snippet }}",
        "documents": "{{ find_patterns.output.results }}",
        "model": "rerank-2.5",
        "limit": "{{ inputs.limit }}"
      }
    },
    {
      "id": "migration_guide",
      "tool": "generate",
      "name": "Generate migration suggestions",
      "inputs": {
        "prompt": "You are a senior software engineer helping with a code migration to {{ inputs.target_framework }}. The developer has the following code that needs to be migrated:\n\n```\n{{ inputs.code_snippet }}\n```\n\nBelow are similar patterns found in the target codebase (already using {{ inputs.target_framework }}). For each similar pattern:\n1. Explain what the existing code does and what the target pattern does\n2. Highlight the key differences in approach\n3. Provide a concrete migration suggestion\n4. Note any gotchas or breaking changes to watch for",
        "context": "{{ rerank_code.output.results }}"
      }
    }
  ],
  "output": {
    "migration_guide": "{{ migration_guide.output.response }}",
    "similar_patterns": "{{ rerank_code.output.results }}"
  }
}
